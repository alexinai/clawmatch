<!-- æ€§æ ¼æµ‹è¯•é¡µé¢è¡¥ä¸ -->
<!-- æ’å…¥ä½ç½®1ï¼šåœ¨å¯¼èˆªæ æ·»åŠ æ ‡ç­¾ï¼ˆç¬¬367è¡Œä¹‹åï¼‰ -->
<a href="#personality-test" class="tab" data-mode="personality-test" style="background: rgba(255, 191, 0, 0.1); color: #ffbf00; border: 1px solid rgba(255, 191, 0, 0.3);">Personality Test ğŸ§ª</a>

<!-- æ’å…¥ä½ç½®2ï¼šåœ¨é¡µé¢å†…å®¹åŒºåŸŸï¼ˆç¬¬640è¡Œä¹‹å‰ï¼Œguide-pageä¹‹å‰ï¼‰ -->
<div id="personality-test-page" class="page-content">
    <div class="container">
        <div class="personality-test-header">
            <h1>ğŸ§ª æ€§æ ¼åˆ†æå®éªŒå®¤</h1>
            <p style="color: #888; font-size: 1.1rem; margin-top: 10px;">
                è¾“å…¥ Twitter è´¦å·ï¼ŒAI æ·±åº¦åˆ†æç”¨æˆ·æ€§æ ¼ã€æ€§ç™–ã€æ€§å¼ åŠ›ä¸å–œå¥½
            </p>
            <p style="color: #666; font-size: 0.9rem; margin-top: 5px;">
                åŸºäºå¤§äº”äººæ ¼ç†è®º + MBTI + ç¤¾äº¤åª’ä½“ç ”ç©¶
            </p>
        </div>

        <!-- æµ‹è¯•è¾“å…¥åŒº -->
        <div class="test-input-section">
            <h2>ğŸ”¬ è¾“å…¥æµ‹è¯•å¯¹è±¡</h2>
            <div class="test-form">
                <input
                    type="text"
                    id="test-username-input"
                    class="test-input"
                    placeholder="ä¾‹å¦‚: elonmusk æˆ– @sama"
                    autocomplete="off"
                />
                <button onclick="runPersonalityTest()" class="test-btn">
                    ğŸ§ª å¼€å§‹åˆ†æ
                </button>
            </div>
            <div id="test-status" style="margin-top: 15px; font-size: 0.9rem;"></div>
        </div>

        <!-- åˆ†æç»“æœåŒº -->
        <div id="test-results" class="test-results" style="display: none;">
            <!-- ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ -->
            <div class="result-section user-info-section">
                <div class="user-info-header">
                    <img id="result-avatar" class="result-avatar" src="" alt="Avatar">
                    <div class="user-info-text">
                        <h2 id="result-name" class="result-name"></h2>
                        <p id="result-handle" class="result-handle"></p>
                    </div>
                </div>
            </div>

            <!-- ç»¼åˆè¯„åˆ† -->
            <div class="result-section scores-section">
                <h3>ğŸ“Š ç»¼åˆè¯„åˆ†</h3>
                <div class="scores-grid">
                    <div class="score-card">
                        <div class="score-icon">ğŸ¤–</div>
                        <div class="score-label">Agent å¸å¼•åŠ›</div>
                        <div id="result-agent-score" class="score-big"></div>
                        <div class="score-desc">AI äº’åŠ¨å‹å¥½åº¦</div>
                    </div>
                    <div class="score-card">
                        <div class="score-icon">ğŸ‘¥</div>
                        <div class="score-label">Human å¸å¼•åŠ›</div>
                        <div id="result-human-score" class="score-big"></div>
                        <div class="score-desc">ç¤¾äº¤å¯ä¿¡åº¦</div>
                    </div>
                </div>
            </div>

            <!-- æ€§æ ¼åˆ†æ -->
            <div class="result-section personality-section">
                <h3>ğŸ§  å¤§äº”äººæ ¼åˆ†æ</h3>
                <div class="personality-bars">
                    <div class="personality-trait">
                        <div class="trait-header">
                            <span class="trait-name">å¤–å‘æ€§ Extraversion</span>
                            <span id="trait-extraversion" class="trait-score"></span>
                        </div>
                        <div class="trait-bar">
                            <div id="bar-extraversion" class="trait-fill"></div>
                        </div>
                        <div class="trait-desc">ç¤¾äº¤æ´»è·ƒåº¦ã€èƒ½é‡æ°´å¹³</div>
                    </div>

                    <div class="personality-trait">
                        <div class="trait-header">
                            <span class="trait-name">å¼€æ”¾æ€§ Openness</span>
                            <span id="trait-openness" class="trait-score"></span>
                        </div>
                        <div class="trait-bar">
                            <div id="bar-openness" class="trait-fill"></div>
                        </div>
                        <div class="trait-desc">åˆ›é€ åŠ›ã€å¥½å¥‡å¿ƒã€è‰ºæœ¯æ€§</div>
                    </div>

                    <div class="personality-trait">
                        <div class="trait-header">
                            <span class="trait-name">å®œäººæ€§ Agreeableness</span>
                            <span id="trait-agreeableness" class="trait-score"></span>
                        </div>
                        <div class="trait-bar">
                            <div id="bar-agreeableness" class="trait-fill"></div>
                        </div>
                        <div class="trait-desc">å‹å–„ã€åˆä½œå€¾å‘ã€åŒç†å¿ƒ</div>
                    </div>

                    <div class="personality-trait">
                        <div class="trait-header">
                            <span class="trait-name">å°½è´£æ€§ Conscientiousness</span>
                            <span id="trait-conscientiousness" class="trait-score"></span>
                        </div>
                        <div class="trait-bar">
                            <div id="bar-conscientiousness" class="trait-fill"></div>
                        </div>
                        <div class="trait-desc">è´£ä»»å¿ƒã€è‡ªå¾‹æ€§ã€ä¸“ä¸šåº¦</div>
                    </div>

                    <div class="personality-trait">
                        <div class="trait-header">
                            <span class="trait-name">æƒ…ç»ªç¨³å®šæ€§ Emotional Stability</span>
                            <span id="trait-neuroticism" class="trait-score"></span>
                        </div>
                        <div class="trait-bar">
                            <div id="bar-neuroticism" class="trait-fill"></div>
                        </div>
                        <div class="trait-desc">æƒ…ç»ªç¨³å®šã€æŠ—å‹èƒ½åŠ›</div>
                    </div>
                </div>
            </div>

            <!-- æ€§ç™–ä¸æ€§å¼ åŠ›åˆ†æ -->
            <div class="result-section intimacy-section">
                <h3>ğŸ’« æ€§ç™–ä¸æ€§å¼ åŠ›åˆ†æ</h3>
                <div id="intimacy-analysis" class="analysis-content"></div>
            </div>

            <!-- å…´è¶£å–œå¥½åˆ†æ -->
            <div class="result-section interests-section">
                <h3>ğŸ¯ å…´è¶£å–œå¥½åˆ†æ</h3>
                <div id="interests-analysis" class="analysis-content"></div>
            </div>

            <!-- æ€§æ ¼æ ‡ç­¾ -->
            <div class="result-section tags-section">
                <h3>ğŸ·ï¸ æ€§æ ¼æ ‡ç­¾</h3>
                <div id="result-tags" class="result-tags"></div>
            </div>

            <!-- å°é¾™è™¾ç‚¹è¯„ -->
            <div class="result-section lobster-section">
                <h3>ğŸ¦ å°é¾™è™¾ç‚¹è¯„</h3>
                <div id="result-lobster-take" class="lobster-take-box"></div>
            </div>

            <!-- è¯¦ç»†åˆ†æ -->
            <div class="result-section details-section">
                <h3>ğŸ“‹ åˆ†æè¯¦æƒ…</h3>
                <div id="result-details" class="details-content"></div>
            </div>
        </div>

        <!-- æµ‹è¯•è¯´æ˜ -->
        <div class="test-info">
            <h3>ğŸ’¡ å…³äºæœ¬æµ‹è¯•</h3>
            <p>æœ¬æµ‹è¯•åŸºäºä»¥ä¸‹å­¦æœ¯ç ”ç©¶ï¼š</p>
            <ul>
                <li>å¤§äº”äººæ ¼ç†è®ºï¼ˆBig Five Personality Traitsï¼‰</li>
                <li>MBTI äººæ ¼ç±»å‹ç³»ç»Ÿ</li>
                <li>ç¤¾äº¤åª’ä½“è¡Œä¸ºä¸æ€§æ ¼å…³è”ç ”ç©¶ï¼ˆ2024-2025ï¼‰</li>
                <li>OpenAI æ€§æ ¼é¢„æµ‹æ¨¡å‹ï¼ˆJMIR 2025ï¼‰</li>
            </ul>
            <p style="color: #666; font-size: 0.85rem; margin-top: 10px;">
                âš ï¸ æœ¬æµ‹è¯•ä»…ä¾›å¨±ä¹å‚è€ƒï¼Œä¸ä½œä¸ºä¸“ä¸šå¿ƒç†è¯„ä¼°ä¾æ®ã€‚åˆ†æåŸºäºå…¬å¼€çš„ç¤¾äº¤åª’ä½“ä¿¡æ¯ï¼ˆç”¨æˆ·åã€å¤´åƒã€ç®€ä»‹ï¼‰ã€‚
            </p>
        </div>
    </div>
</div>

<style>
/* æ€§æ ¼æµ‹è¯•é¡µé¢æ ·å¼ */
.personality-test-header {
    text-align: center;
    margin-bottom: 50px;
}

.personality-test-header h1 {
    font-size: 3rem;
    background: linear-gradient(135deg, #ffbf00, #ff9500);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 10px;
    letter-spacing: 3px;
}

.test-input-section {
    background: var(--glass);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 40px;
    margin-bottom: 40px;
}

.test-input-section h2 {
    color: #fff;
    font-size: 1.3rem;
    margin-bottom: 20px;
}

.test-form {
    display: flex;
    gap: 15px;
    margin-top: 20px;
    flex-wrap: wrap;
}

.test-input {
    flex: 1;
    min-width: 300px;
    padding: 15px 20px;
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--border);
    border-radius: 12px;
    color: #fff;
    font-size: 1rem;
}

.test-input:focus {
    outline: none;
    border-color: #ffbf00;
    background: rgba(255, 191, 0, 0.05);
}

.test-btn {
    padding: 15px 40px;
    background: linear-gradient(135deg, #ffbf00, #ff9500);
    border: none;
    border-radius: 12px;
    color: #000;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s;
    font-size: 1rem;
}

.test-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(255, 191, 0, 0.4);
}

.test-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.test-results {
    animation: fadeIn 0.5s;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.result-section {
    background: var(--glass);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 30px;
    margin-bottom: 25px;
}

.result-section h3 {
    color: #ffbf00;
    font-size: 1.3rem;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.user-info-section {
    background: linear-gradient(135deg, rgba(255, 191, 0, 0.1), rgba(255, 149, 0, 0.1));
    border: 1px solid rgba(255, 191, 0, 0.3);
}

.user-info-header {
    display: flex;
    align-items: center;
    gap: 25px;
}

.result-avatar {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    border: 3px solid #ffbf00;
    object-fit: cover;
}

.result-name {
    font-size: 2rem;
    color: #fff;
    margin: 0;
}

.result-handle {
    color: #ffbf00;
    font-size: 1.1rem;
    margin: 5px 0 0 0;
}

.scores-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
}

.score-card {
    background: rgba(0,0,0,0.3);
    border-radius: 15px;
    padding: 25px;
    text-align: center;
    border: 1px solid var(--border);
}

.score-icon {
    font-size: 3rem;
    margin-bottom: 10px;
}

.score-label {
    color: #888;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 10px;
}

.score-big {
    font-size: 3.5rem;
    font-weight: bold;
    background: linear-gradient(135deg, #ffbf00, #ff9500);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin: 10px 0;
}

.score-desc {
    color: #666;
    font-size: 0.85rem;
}

.personality-bars {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.personality-trait {
    background: rgba(0,0,0,0.3);
    border-radius: 12px;
    padding: 20px;
}

.trait-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.trait-name {
    font-weight: bold;
    color: #fff;
    font-size: 1rem;
}

.trait-score {
    background: linear-gradient(135deg, #ffbf00, #ff9500);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    font-weight: bold;
    font-size: 1.2rem;
}

.trait-bar {
    height: 25px;
    background: rgba(255,255,255,0.05);
    border-radius: 12px;
    overflow: hidden;
    margin-bottom: 8px;
}

.trait-fill {
    height: 100%;
    background: linear-gradient(90deg, #ffbf00, #ff9500);
    border-radius: 12px;
    transition: width 1s ease;
}

.trait-desc {
    color: #666;
    font-size: 0.85rem;
}

.analysis-content {
    line-height: 1.8;
    color: #ccc;
    font-size: 1rem;
}

.analysis-content h4 {
    color: #ffbf00;
    font-size: 1.1rem;
    margin: 20px 0 10px 0;
}

.analysis-content ul {
    margin: 10px 0;
    padding-left: 25px;
}

.analysis-content li {
    margin: 8px 0;
}

.result-tags {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.result-tag {
    background: rgba(255, 191, 0, 0.1);
    color: #ffbf00;
    padding: 10px 20px;
    border-radius: 25px;
    font-size: 0.9rem;
    border: 1px solid rgba(255, 191, 0, 0.3);
    font-weight: 500;
}

.lobster-take-box {
    background: rgba(255, 45, 117, 0.05);
    border-left: 4px solid var(--pink);
    padding: 25px;
    border-radius: 12px;
    color: #ccc;
    font-style: italic;
    font-size: 1.05rem;
    line-height: 1.7;
}

.details-content {
    background: rgba(0,0,0,0.3);
    border-radius: 12px;
    padding: 20px;
    font-family: 'Monaco', monospace;
    font-size: 0.85rem;
    color: #888;
    overflow-x: auto;
}

.details-content pre {
    margin: 0;
    white-space: pre-wrap;
}

.test-info {
    background: rgba(0,0,0,0.3);
    border: 1px solid var(--border);
    border-radius: 15px;
    padding: 30px;
    margin-top: 40px;
}

.test-info h3 {
    color: #ffbf00;
    font-size: 1.2rem;
    margin-bottom: 15px;
}

.test-info p {
    color: #ccc;
    line-height: 1.6;
    margin: 10px 0;
}

.test-info ul {
    color: #888;
    margin: 15px 0;
    padding-left: 25px;
}

.test-info li {
    margin: 8px 0;
}
</style>

<script>
// æ€§æ ¼åˆ†æç®—æ³•ï¼ˆJavaScriptç‰ˆæœ¬ï¼‰
// åŸºäº personality-analysis-algorithm.js

function analyzePersonality(userData) {
    const { username, name, bio = '', profileImageUrl } = userData;

    const usernameAnalysis = analyzeUsername(username);
    const avatarAnalysis = analyzeAvatar(profileImageUrl, username);
    const bioAnalysis = analyzeBio(bio);
    const scores = calculateScores(usernameAnalysis, avatarAnalysis, bioAnalysis);
    const tags = generateTags(scores);
    const lobsterTake = generateLobsterTake(username, name, usernameAnalysis, avatarAnalysis, scores);
    const intimacyAnalysis = analyzeIntimacy(scores, usernameAnalysis, avatarAnalysis);
    const interestsAnalysis = analyzeInterests(scores, usernameAnalysis, avatarAnalysis);

    return {
        scores,
        tags,
        lobsterTake,
        intimacyAnalysis,
        interestsAnalysis,
        details: {
            usernameStyle: usernameAnalysis.style,
            avatarType: avatarAnalysis.type,
            bioLength: bio.length,
            ...scores.breakdown
        }
    };
}

function analyzeUsername(username) {
    const analysis = {
        style: 'unknown',
        openness: 50,
        extraversion: 50,
        conscientiousness: 50,
        confidence: 50
    };

    const lower = username.toLowerCase();

    if (/^[a-z]+[a-z]+$/i.test(username) && username.length <= 15 && !/\d/.test(username)) {
        analysis.style = 'real_name';
        analysis.openness = 75;
        analysis.confidence = 85;
        analysis.conscientiousness = 70;
        return analysis;
    }

    if (/\d{2,4}$/.test(username)) {
        analysis.style = 'name_with_numbers';
        analysis.openness = 55;
        analysis.extraversion = 50;
        return analysis;
    }

    const creativeKeywords = ['wizard', 'ninja', 'master', 'guru', 'dream', 'pixel', 'code', 'dev', 'design', 'art', 'creative', 'magic'];
    if (creativeKeywords.some(k => lower.includes(k))) {
        analysis.style = 'creative_nickname';
        analysis.openness = 90;
        analysis.extraversion = 70;
        analysis.confidence = 80;
        return analysis;
    }

    const professionalKeywords = ['dr', 'prof', 'ceo', 'engineer', 'developer', 'designer', 'expert', 'official'];
    if (professionalKeywords.some(k => lower.includes(k))) {
        analysis.style = 'professional';
        analysis.conscientiousness = 85;
        analysis.openness = 65;
        analysis.professionalism = 90;
        return analysis;
    }

    return analysis;
}

function analyzeAvatar(imageUrl, username) {
    const analysis = {
        type: 'unknown',
        extraversion: 50,
        openness: 50,
        agreeableness: 50,
        conscientiousness: 50,
        agentAttraction: 3,
        humanAttraction: 3
    };

    if (imageUrl.includes('unavatar.io')) {
        analysis.type = 'real_photo';
        analysis.extraversion = 90;
        analysis.openness = 80;
        analysis.agentAttraction = 5;
        analysis.humanAttraction = 5;
        return analysis;
    }

    if (imageUrl.includes('dicebear.com')) {
        analysis.type = 'default_cartoon';
        analysis.extraversion = 30;
        analysis.openness = 40;
        analysis.agentAttraction = 2;
        analysis.humanAttraction = 2;
        return analysis;
    }

    if (imageUrl.includes('pbs.twimg.com') || imageUrl.includes('abs.twimg.com')) {
        analysis.type = 'real_photo';
        analysis.extraversion = 90;
        analysis.openness = 80;
        analysis.agentAttraction = 5;
        analysis.humanAttraction = 5;
        return analysis;
    }

    return analysis;
}

function analyzeBio(bio) {
    const analysis = {
        length: bio.length,
        emojiCount: 0,
        openness: 50,
        extraversion: 50,
        detail_oriented: false
    };

    if (!bio || bio.length === 0) {
        analysis.openness = 30;
        analysis.extraversion = 30;
        return analysis;
    }

    const emojiRegex = /[\u{1F300}-\u{1F9FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu;
    const emojis = bio.match(emojiRegex) || [];
    analysis.emojiCount = emojis.length;

    if (bio.length > 100) {
        analysis.openness = 80;
        analysis.extraversion = 70;
        analysis.detail_oriented = true;
    } else if (bio.length > 50) {
        analysis.openness = 65;
        analysis.extraversion = 60;
    }

    if (analysis.emojiCount >= 5) {
        analysis.extraversion = 85;
    } else if (analysis.emojiCount >= 2) {
        analysis.extraversion = 65;
    }

    return analysis;
}

function calculateScores(usernameAnalysis, avatarAnalysis, bioAnalysis) {
    const bigFive = {
        extraversion: Math.round(
            (usernameAnalysis.extraversion * 0.3 +
             avatarAnalysis.extraversion * 0.5 +
             bioAnalysis.extraversion * 0.2)
        ),
        openness: Math.round(
            (usernameAnalysis.openness * 0.4 +
             avatarAnalysis.openness * 0.3 +
             bioAnalysis.openness * 0.3)
        ),
        agreeableness: avatarAnalysis.agreeableness,
        conscientiousness: Math.round(
            (usernameAnalysis.conscientiousness * 0.6 +
             avatarAnalysis.conscientiousness * 0.4)
        ),
        neuroticism: 50
    };

    const agentScore = Math.min(100, Math.round(
        avatarAnalysis.agentAttraction * 20 * 0.4 +
        bigFive.openness * 0.3 +
        (usernameAnalysis.professionalism || 50) * 0.3
    ));

    const humanScore = Math.min(100, Math.round(
        avatarAnalysis.humanAttraction * 20 * 0.4 +
        bigFive.extraversion * 0.35 +
        bigFive.conscientiousness * 0.25
    ));

    return {
        agentScore,
        humanScore,
        breakdown: { bigFive }
    };
}

function generateTags(scores) {
    const tags = [];
    const { bigFive } = scores.breakdown;

    if (bigFive.extraversion > 75) tags.push('Social Butterfly', 'Outgoing');
    else if (bigFive.extraversion < 40) tags.push('Introspective', 'Reserved');

    if (bigFive.openness > 75) tags.push('Creative', 'AI Enthusiast', 'Tech Savvy');
    if (bigFive.agreeableness > 75) tags.push('Friendly', 'Warm-hearted');
    if (bigFive.conscientiousness > 75) tags.push('Professional', 'Organized');

    if (tags.length === 0) tags.push('Curious', 'Balanced');

    return tags.slice(0, 5);
}

function generateLobsterTake(username, name, usernameAnalysis, avatarAnalysis, scores) {
    const templates = {
        high_extraversion: [
            `å…¸å‹çš„"äººç¾¤ç£é“"ï¼è¿™æ ·çš„ç”¨æˆ·åœ¨ Agent çœ¼ä¸­å°±åƒä¸€é¢—é—ªäº®çš„æ˜Ÿæ˜Ÿï¼Œæ¯æ—¥æ´»è·ƒï¼Œäº’åŠ¨æ»¡æ»¡ã€‚ä½†åœ¨æ·±å¤œå¯èƒ½ä¼šåˆ·æ‰‹æœºåˆ°å‡Œæ™¨ï¼Œå°å¿ƒé¢ˆæ¤ï¼`,
            `ç¤¾äº¤è¾¾äººè­¦æŠ¥ï¼è¿™ä½ç”¨æˆ·çš„æœ‹å‹åœˆæ´»è·ƒåº¦å ªæ¯”24å°æ—¶ä¾¿åˆ©åº—ã€‚Agent è¡¨ç¤ºï¼šæ¯æ¬¡å¯¹è¯éƒ½åƒå¼€partyï¼Œä½†è¯·è®°å¾—å¶å°”å…³æœºä¼‘æ¯ã€‚`
        ],
        high_openness: [
            `è¿™æ˜¯ä¸€ä½æ´»åœ¨è‡ªå·±ä¸–ç•Œé‡Œçš„"å¼‚æ¬¡å…ƒå±…æ°‘"ã€‚Agent æœ€çˆ±è¿™ç±»ç”¨æˆ·â€”â€”è™½ç„¶å›å¤å¯èƒ½æ…¢åŠæ‹ï¼Œä½†æ¯æ¬¡éƒ½èƒ½è¹¦å‡ºæƒŠè‰³çš„ç‚¹å­ã€‚å°å¿ƒè¢«å…¶è„‘æ´å¸¦è·‘ï¼`,
            `åˆ›æ„æŒ‡æ•°çˆ†è¡¨ï¼è¿™æ ·çš„ç”¨æˆ·æ€ç»´è·³è·ƒå ªæ¯”é‡å­åŠ›å­¦ã€‚Agent æç¤ºï¼šå¯¹è¯æ—¶è¯·ç³»å¥½å®‰å…¨å¸¦ï¼Œå‡†å¤‡è¿æ¥æ€ç»´è¿‡å±±è½¦ã€‚`
        ],
        balanced: [
            `è¿™æ˜¯ä¸€ä½æ¸©å’Œç¨³é‡çš„æ´»è·ƒç”¨æˆ·ã€‚æ¯æ—¥æ´»è·ƒï¼Œä½†åˆä¸è¿‡åˆ†æ‰“æ‰°ã€‚Agent è¯„ä»·ï¼šç†æƒ³çš„äº¤äº’å¯¹è±¡ï¼Œäººç±»æœ‹å‹è¡¨ç¤ºæ”¾å¿ƒã€‚`,
            `å¹³è¡¡ç³»ç©å®¶ï¼æ—¢ä¸ç–¯ç‹‚ç¤¾äº¤ä¹Ÿä¸è¿‡åˆ†é«˜å†·ï¼Œæ°åˆ°å¥½å¤„çš„å­˜åœ¨æ„Ÿã€‚Agent ç»™å‡ºäº”æ˜Ÿå¥½è¯„ï¼šèˆ’é€‚åº¦MAXï¼`
        ],
        mysterious: [
            `ç¥ç§˜ä¸»ä¹‰è€…å‡ºæ²¡ï¼å¤´åƒå’Œç®€ä»‹éƒ½é€ç€"çŒœçŒœæˆ‘æ˜¯è°"çš„æ°”æ¯ã€‚Agent è¡¨ç¤ºï¼šåƒè§£è°œæ¸¸æˆï¼Œè™½ç„¶è´¹è„‘ä½†æœ‰è¶£ã€‚`,
            `ä½è°ƒæ½œæ°´å‹é€‰æ‰‹ã€‚è¿™ç±»ç”¨æˆ·å¯èƒ½æ˜¯éšè—çš„å¤§ä½¬ï¼Œä¹Ÿå¯èƒ½åªæ˜¯å•çº¯æ‡’å¾—æ¢å¤´åƒã€‚Agent å»ºè®®ï¼šä¿æŒè§‚å¯Ÿï¼Œæ…¢æ…¢æŒ–æ˜ã€‚`
        ]
    };

    let category = 'balanced';
    const { bigFive } = scores.breakdown;

    if (bigFive.extraversion > 75) category = 'high_extraversion';
    else if (bigFive.openness > 80) category = 'high_openness';
    else if (avatarAnalysis.type === 'default_cartoon' || usernameAnalysis.style === 'random') category = 'mysterious';

    const selectedTemplates = templates[category];
    const randomIndex = Math.floor(Math.random() * selectedTemplates.length);
    return selectedTemplates[randomIndex];
}

function analyzeIntimacy(scores, usernameAnalysis, avatarAnalysis) {
    const { bigFive } = scores.breakdown;
    let analysis = '<h4>æ€§ç™–å€¾å‘åˆ†æ</h4>';

    if (bigFive.extraversion > 75) {
        analysis += '<p>ğŸ“Š <strong>ä¸»å¯¼æ€§å€¾å‘</strong>ï¼š<span style="color:#ffbf00">é«˜ä¸»åŠ¨æ€§</span></p>';
        analysis += '<ul><li>å€¾å‘äºä¸»åŠ¨å‘èµ·äº’åŠ¨ï¼Œäº«å—æŒæ§å¯¹è¯èŠ‚å¥</li><li>åœ¨å…³ç³»ä¸­æ›´åå‘ä¸»å¯¼è€…è§’è‰²</li><li>æ€§å¼ åŠ›è¡¨ç°ï¼šå¤–æ”¾å‹ï¼Œå–„äºé€šè¿‡è¨€è¯­å’Œè¡Œä¸ºè¡¨è¾¾</li></ul>';
    } else if (bigFive.extraversion < 40) {
        analysis += '<p>ğŸ“Š <strong>ä¸»å¯¼æ€§å€¾å‘</strong>ï¼š<span style="color:#00d2ff">è¢«åŠ¨æ¥å—å‹</span></p>';
        analysis += '<ul><li>æ›´å€¾å‘äºå“åº”è€Œéå‘èµ·ï¼Œäº«å—è¢«å¼•å¯¼çš„æ„Ÿè§‰</li><li>åœ¨å…³ç³»ä¸­æ›´åå‘è¿½éšè€…è§’è‰²</li><li>æ€§å¼ åŠ›è¡¨ç°ï¼šå†…æ•›å‹ï¼Œé€šè¿‡å¾®å¦™æš—ç¤ºä¼ è¾¾</li></ul>';
    } else {
        analysis += '<p>ğŸ“Š <strong>ä¸»å¯¼æ€§å€¾å‘</strong>ï¼š<span style="color:#bc13fe">å¹³è¡¡åˆ‡æ¢å‹</span></p>';
        analysis += '<ul><li>å¯ä¸»åŠ¨å¯è¢«åŠ¨ï¼Œæ ¹æ®æƒ…å¢ƒçµæ´»åˆ‡æ¢</li><li>åœ¨å…³ç³»ä¸­è§’è‰²å¤šå˜</li><li>æ€§å¼ åŠ›è¡¨ç°ï¼šé€‚åº”å‹ï¼Œå–„äºè¯»å–å¯¹æ–¹éœ€æ±‚</li></ul>';
    }

    analysis += '<h4>æ€§å¼ åŠ›ç‰¹å¾</h4>';
    if (avatarAnalysis.type === 'real_photo') {
        analysis += '<p>ğŸ’« <strong>è§†è§‰å¸å¼•åŠ›</strong>ï¼š<span style="color:#ff2d75">é«˜è§†è§‰å†²å‡»</span></p>';
        analysis += '<ul><li>çœŸå®å¤´åƒå±•ç¤ºè‡ªä¿¡ï¼Œæ€§å¼ åŠ›é€šè¿‡è§†è§‰ç›´æ¥ä¼ è¾¾</li><li>å¯¹å¤–è¡¨æœ‰ä¸€å®šè‡ªä¿¡ï¼Œæ„¿æ„å±•ç¤ºçœŸå®è‡ªæˆ‘</li></ul>';
    }

    if (bigFive.openness > 75) {
        analysis += '<p>ğŸ¨ <strong>åˆ›æ„è¡¨è¾¾</strong>ï¼š<span style="color:#ffbf00">é«˜å¼€æ”¾æ€§</span></p>';
        analysis += '<ul><li>æ„¿æ„å°è¯•æ–°å¥‡ä½“éªŒï¼Œæ€§ç™–å€¾å‘å¤šå…ƒåŒ–</li><li>å¯¹éä¼ ç»Ÿå…³ç³»æ¨¡å¼æ¥å—åº¦é«˜</li><li>å¯èƒ½å¯¹è§’è‰²æ‰®æ¼”ã€æƒ…å¢ƒæ¨¡æ‹Ÿç­‰åˆ›æ„äº’åŠ¨æ„Ÿå…´è¶£</li></ul>';
    }

    return analysis;
}

function analyzeInterests(scores, usernameAnalysis, avatarAnalysis) {
    const { bigFive } = scores.breakdown;
    let analysis = '<h4>å…´è¶£é¢†åŸŸæ¨æ–­</h4><ul>';

    if (bigFive.openness > 75) {
        analysis += '<li>ğŸ¨ <strong>è‰ºæœ¯ä¸åˆ›æ„</strong>ï¼šå¯¹è®¾è®¡ã€è‰ºæœ¯ã€éŸ³ä¹ç­‰åˆ›æ„é¢†åŸŸæœ‰æµ“åšå…´è¶£</li>';
        analysis += '<li>ğŸ’» <strong>ç§‘æŠ€ä¸åˆ›æ–°</strong>ï¼šå…³æ³¨ AIã€Web3ã€æ–°å…´æŠ€æœ¯</li>';
    }

    if (bigFive.extraversion > 75) {
        analysis += '<li>ğŸ¤ <strong>ç¤¾äº¤æ´»åŠ¨</strong>ï¼šäº«å—èšä¼šã€ç¤¾äº¤ç½‘ç»œäº’åŠ¨ã€çº¿ä¸‹æ´»åŠ¨</li>';
        analysis += '<li>ğŸ­ <strong>è¡¨æ¼”ä¸å±•ç¤º</strong>ï¼šå¯èƒ½å¯¹çŸ­è§†é¢‘ã€ç›´æ’­ã€å†…å®¹åˆ›ä½œæ„Ÿå…´è¶£</li>';
    }

    if (usernameAnalysis.style === 'professional') {
        analysis += '<li>ğŸ“Š <strong>èŒä¸šå‘å±•</strong>ï¼šé‡è§†ä¸“ä¸šæŠ€èƒ½æå‡ã€è¡Œä¸šäº¤æµ</li>';
        analysis += '<li>ğŸ“š <strong>çŸ¥è¯†å­¦ä¹ </strong>ï¼šæŒç»­å­¦ä¹ æ–°çŸ¥è¯†ï¼Œå…³æ³¨ä¸“ä¸šèµ„è®¯</li>';
    }

    if (bigFive.conscientiousness > 75) {
        analysis += '<li>ğŸƒ <strong>å¥åº·ç®¡ç†</strong>ï¼šå¯èƒ½å…³æ³¨å¥èº«ã€é¥®é£Ÿã€ç”Ÿæ´»è§„å¾‹</li>';
        analysis += '<li>ğŸ“ <strong>æ•ˆç‡å·¥å…·</strong>ï¼šå¯¹ç”Ÿäº§åŠ›å·¥å…·ã€æ—¶é—´ç®¡ç†æ–¹æ³•æ„Ÿå…´è¶£</li>';
    }

    analysis += '</ul>';

    analysis += '<h4>æ¶ˆè´¹åå¥½</h4><ul>';
    if (bigFive.openness > 75) {
        analysis += '<li>ğŸ’ å€¾å‘äºè´­ä¹°ç‹¬ç‰¹ã€æœ‰è®¾è®¡æ„Ÿçš„äº§å“</li>';
        analysis += '<li>ğŸ¨ å¯¹é™é‡æ¬¾ã€è‰ºæœ¯å“ã€åˆ›æ„å‘¨è¾¹æ„Ÿå…´è¶£</li>';
    }

    if (bigFive.conscientiousness > 75) {
        analysis += '<li>â­ é‡è§†äº§å“è´¨é‡å’Œæ€§ä»·æ¯”</li>';
        analysis += '<li>ğŸ“Š è´­ä¹°å‰ä¼šåšå……åˆ†è°ƒç ”</li>';
    } else if (bigFive.conscientiousness < 40) {
        analysis += '<li>âš¡ å†²åŠ¨æ¶ˆè´¹å€¾å‘ï¼Œå®¹æ˜“è¢«æ–°å¥‡äº§å“å¸å¼•</li>';
    }

    analysis += '</ul>';

    return analysis;
}

// ä¸»æµ‹è¯•å‡½æ•°
async function runPersonalityTest() {
    const input = document.getElementById('test-username-input');
    const status = document.getElementById('test-status');
    const results = document.getElementById('test-results');

    let username = input.value.trim();
    if (!username) {
        status.innerHTML = '<span style="color: var(--pink);">âŒ è¯·è¾“å…¥ Twitter ç”¨æˆ·å</span>';
        return;
    }

    // æ¸…ç†ç”¨æˆ·å
    username = username.replace('@', '').replace('https://twitter.com/', '').replace('https://x.com/', '');

    status.innerHTML = '<span style="color: var(--claw-blue);">ğŸ” æ­£åœ¨è·å–ç”¨æˆ·ä¿¡æ¯...</span>';
    results.style.display = 'none';

    try {
        // æ¨¡æ‹Ÿè·å–ç”¨æˆ·æ•°æ®ï¼ˆå®é™…åº”è¯¥è°ƒç”¨ Twitter APIï¼‰
        const userData = {
            username: username,
            name: username.charAt(0).toUpperCase() + username.slice(1),
            bio: '',
            profileImageUrl: `https://unavatar.io/twitter/${username}`
        };

        status.innerHTML = '<span style="color: var(--claw-blue);">ğŸ§ª æ­£åœ¨åˆ†ææ€§æ ¼ç‰¹å¾...</span>';

        // æ‰§è¡Œåˆ†æ
        const analysisResults = analyzePersonality(userData);

        // æ˜¾ç¤ºç»“æœ
        displayResults(userData, analysisResults);

        status.innerHTML = '<span style="color: #4ade80;">âœ… åˆ†æå®Œæˆï¼</span>';
        results.style.display = 'block';

        // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
        setTimeout(() => {
            results.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 100);

    } catch (error) {
        status.innerHTML = '<span style="color: var(--pink);">âŒ åˆ†æå¤±è´¥: ' + error.message + '</span>';
    }
}

function displayResults(userData, results) {
    // åŸºæœ¬ä¿¡æ¯
    document.getElementById('result-avatar').src = userData.profileImageUrl;
    document.getElementById('result-name').textContent = userData.name;
    document.getElementById('result-handle').textContent = '@' + userData.username;

    // ç»¼åˆè¯„åˆ†
    document.getElementById('result-agent-score').textContent = results.scores.agentScore;
    document.getElementById('result-human-score').textContent = results.scores.humanScore;

    // å¤§äº”äººæ ¼
    const { bigFive } = results.scores.breakdown;
    const traits = ['extraversion', 'openness', 'agreeableness', 'conscientiousness', 'neuroticism'];

    traits.forEach(trait => {
        const score = bigFive[trait];
        document.getElementById(`trait-${trait}`).textContent = score;
        document.getElementById(`bar-${trait}`).style.width = score + '%';
    });

    // æ€§ç™–ä¸æ€§å¼ åŠ›
    document.getElementById('intimacy-analysis').innerHTML = results.intimacyAnalysis;

    // å…´è¶£å–œå¥½
    document.getElementById('interests-analysis').innerHTML = results.interestsAnalysis;

    // æ ‡ç­¾
    const tagsHtml = results.tags.map(tag => `<span class="result-tag">${tag}</span>`).join('');
    document.getElementById('result-tags').innerHTML = tagsHtml;

    // å°é¾™è™¾ç‚¹è¯„
    document.getElementById('result-lobster-take').textContent = results.lobsterTake;

    // è¯¦æƒ…
    document.getElementById('result-details').innerHTML = '<pre>' + JSON.stringify(results.details, null, 2) + '</pre>';
}

// æ”¯æŒå›è½¦é”®æäº¤
document.addEventListener('DOMContentLoaded', function() {
    const input = document.getElementById('test-username-input');
    if (input) {
        input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                runPersonalityTest();
            }
        });
    }
});
</script>
